var pe=Object.defineProperty;var de=(r,e,t)=>e in r?pe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var W=(r,e,t)=>de(r,typeof e!="symbol"?e+"":e,t);import{a as j,t as A,d as he,e as H,s as ge}from"../chunks/disclose-version.w09OKvMr.js";import{p as ee,t as q,a as te,c as y,ac as C,r as b,ad as ve,e as ye,y as p,g as u,ae as _,af as Y,s as h}from"../chunks/entry.BCpqZHYJ.js";import{i as U,s as be,p as w,a as we}from"../chunks/props.CeX9gEMn.js";import{g as re,G as me,s as $,r as N,b as S}from"../chunks/github.BSyZe2OA.js";import{p as _e}from"../chunks/stores.CbtBh4Gh.js";import"../chunks/legacy.KdXuhMaS.js";import{i as xe}from"../chunks/lifecycle.B7VBInBd.js";var je=A('<div id="auth_social-login" class="flex flex-col gap-3"><a class="btn flex items-center gap-2 preset-filled-surface-100-900"><!> Continue with GitHub</a></div>');function Ae(r,e){ee(e,!1);const t=re(),[o,d]=t;xe();var n=je(),s=y(n);q(()=>$(s,"href",o("/api/auth/oauth/github",void 0)));var c=y(s);me(c,{class:"size-5 dark:fill-white"}),C(),b(s),b(n),j(r,n),te()}var Q;(function(r){r[r.Include=0]="Include",r[r.None=1]="None"})(Q||(Q={}));var X;(function(r){r[r.Required=0]="Required",r[r.Ignore=1]="Ignore"})(X||(X={}));function x(r){return Ie(r,ke,R.Include)}function Ie(r,e,t){let o="";for(let d=0;d<r.byteLength;d+=3){let n=0,s=0;for(let c=0;c<3&&d+c<r.byteLength;c++)n=n<<8|r[d+c],s+=8;for(let c=0;c<4;c++)s>=6?(o+=e[n>>s-6&63],s-=6):s>0?(o+=e[n<<6-s&63],s=0):t===R.Include&&(o+="=")}return o}const ke="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function Ee(r){return Ne(r,Se,O.Required)}function Ne(r,e,t){const o=new Uint8Array(Math.ceil(r.length/4)*3);let d=0;for(let n=0;n<r.length;n+=4){let s=0,c=0;for(let l=0;l<4;l++)if(!(t===O.Required&&r[n+l]==="=")&&!(t===O.Ignore&&(n+l>=r.length||r[n+l]==="="))){if(l>0&&r[n+l-1]==="=")throw new Error("Invalid padding");if(!(r[n+l]in e))throw new Error("Invalid character");s|=e[r[n+l]]<<(3-l)*6,c+=6}if(c<24){let l;if(c===12)l=s&65535;else if(c===18)l=s&255;else throw new Error("Invalid padding");if(l!==0)throw new Error("Invalid padding")}const m=Math.floor(c/8);for(let l=0;l<m;l++)o[d]=s>>16-l*8&255,d++}return o.slice(0,d)}var R;(function(r){r[r.Include=0]="Include",r[r.None=1]="None"})(R||(R={}));var O;(function(r){r[r.Required=0]="Required",r[r.Ignore=1]="Ignore"})(O||(O={}));const Se={0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,"+":62,"/":63};class B{constructor(e){W(this,"value");this.value=e}has(...e){if(e.length<1)throw new TypeError("Invalid path");let t=this.value;for(let o=0;o<e.length;o++){if(typeof t!="object"||t===null||!(e[o]in t))return!1;t=t[e[o]]}return!0}get(...e){if(e.length<1)throw new TypeError("Invalid path");let t=this.value;for(let o=0;o<e.length;o++){if(typeof t!="object"||t===null)throw new Error(`Value in path ${e.slice(0,o+1).join(".")} is not an object`);if(!(e[o]in t))throw new Error(`Path ${e.slice(0,o+1).join(".")} does not exist`);t=t[e[o]]}return t}isString(...e){return typeof this.get(...e)=="string"}getString(...e){const t=this.get(...e);if(typeof t!="string")throw new Error(`Value in path ${e.join(".")} is not a string`);return t}isNumber(...e){return typeof this.get(...e)=="number"}getNumber(...e){const t=this.get(...e);if(typeof t!="number")throw new Error(`Value in path ${e.join(".")} is not a string`);return t}isBoolean(...e){return typeof this.get(...e)=="boolean"}getBoolean(...e){const t=this.get(...e);if(typeof t!="boolean")throw new Error(`Value in path ${e.join(".")} is not a boolean`);return t}isBigInt(...e){return typeof this.get(...e)=="bigint"}getBigInt(...e){const t=this.get(...e);if(typeof t!="bigint")throw new Error(`Value in path ${e.join(".")} is not a bigint`);return t}isObject(...e){const t=this.get(...e);return typeof t=="object"&&t!==null}getObject(...e){const t=this.get(...e);if(typeof t!="object"||t===null)throw new Error(`Value in path ${e.join(".")} is not a object`);return t}isArray(...e){return Array.isArray(this.get(...e))}getArray(...e){const t=this.get(...e);if(!Array.isArray(t))throw new Error(`Value in path ${e.join(".")} is not a object`);return t}isNull(...e){return this.get(...e)===null}isUndefined(...e){return this.get(...e)===void 0}createParser(...e){return new B(this.getObject(...e))}}async function Z(){const r=await fetch("/api/auth/webauthn/challenge",{method:"POST"});if(!r.ok)throw new Error("Failed to create challenge");const e=await r.json(),t=new B(e);return Ee(t.getString("challenge"))}var Oe=A('<form class="flex flex-col gap-3"><input class="input" type="email" placeholder="Enter your email" required> <button class="btn w-full preset-filled" type="submit">Continue</button></form>'),Ue=A('<div class="flex flex-col items-center gap-2"><button class="btn w-full preset-filled">Continue with passkey</button></div>'),qe=A('<form class="flex flex-col gap-3" autocomplete="off"><input class="input" type="text" placeholder="First name" required> <input class="input" type="text" placeholder="Last name" required> <input class="input" type="text" placeholder="One time password" required> <input class="input disabled:bg-surface-100-900" type="email" placeholder="Email" disabled required> <button class="btn w-full preset-filled" type="submit">Create Passkey and Sign Up</button></form>'),Ce=A('<p class="text-error-500"> </p>'),Re=A('<div class="flex min-h-screen items-center justify-center"><div class="card flex w-full max-w-md flex-col gap-6 border p-6 text-center border-surface-200-800"><div id="auth_sign-in_title" class="flex flex-col gap-3"><h2 class="h3 text-center">Sign in or create account</h2> <p class="text-center text-surface-600-400">Get started for free</p></div> <!> <div class="flex items-center"><hr class="hr"> <div class="mx-4 text-surface-500">OR</div> <hr class="hr"></div> <!> <!> <!> <p class="text-center text-xs">By continuing, you agree to our <a class="anchor">Terms of Service</a> and <a class="anchor">Privacy Policy</a>.</p> <!></div></div>');function Ge(r,e){ee(e,!0);const[t,o]=be(),d=()=>we(_e,"$page",t);let n=_(""),s=_(""),c=_(""),m=_(""),l=_(""),I=_(null);ve(()=>{const i=new URLSearchParams(d().url.searchParams);p(n,w(i.get("error")||"")),u(n)&&p(n,w(decodeURIComponent(u(n))))}),ye(()=>{u(I)&&V()});async function ae(i){i.preventDefault();try{const a=await fetch(`/api/auth/webauthn/verify-email?email=${encodeURIComponent(u(s))}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok){const g=await a.text();throw new Error(g)}const{exists:f}=await a.json();p(I,w(f))}catch(a){p(n,w((a==null?void 0:a.message)??"Error verifying email."))}}function F(i){switch(i.name){case"NotAllowedError":return"Authentication was canceled or timed out. Please try again.";case"InvalidStateError":return"There was an issue with the authentication state. Please refresh the page and try again.";case"AbortError":return"Authentication was aborted. Please try again.";default:return i.message||"An unexpected error occurred. Please try again."}}async function V(){try{const i=await Z(),a=await navigator.credentials.get({publicKey:{challenge:i,userVerification:"required"}});if(!(a instanceof PublicKeyCredential)){p(n,"Failed to retrieve credential.");return}if(!(a.response instanceof AuthenticatorAssertionResponse)){p(n,"Unexpected error: invalid credential response.");return}const f=await fetch("/api/auth/webauthn/passkey/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential_id:x(new Uint8Array(a.rawId)),signature:x(new Uint8Array(a.response.signature)),authenticator_data:x(new Uint8Array(a.response.authenticatorData)),client_data_json:x(new Uint8Array(a.response.clientDataJSON))})});f.ok?Y("/"):p(n,w(await f.text()))}catch(i){p(n,w(F(i)))}}async function ne(i){i.preventDefault();try{const a=await Z(),f=await navigator.credentials.create({publicKey:{challenge:a,user:{displayName:u(c)+" "+u(m),id:e.data.credentialUserId,name:u(s)},rp:{name:"Your App Name"},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],attestation:"none",authenticatorSelection:{userVerification:"required",residentKey:"required",requireResidentKey:!0}}});if(!(f instanceof PublicKeyCredential))throw new Error("Failed to create public key credential.");if(!(f.response instanceof AuthenticatorAttestationResponse))throw new Error("Unexpected error: invalid credential response.");const g=x(new Uint8Array(f.response.attestationObject)),k=x(new Uint8Array(f.response.clientDataJSON)),E=await fetch("/api/auth/webauthn/passkey/sign-up",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:u(c),lastName:u(m),email:u(s),otp:u(l),userId:e.data.userId,encodedAttestationObject:g,encodedClientDataJSON:k})});if(!E.ok){const v=await E.text();throw new Error(v||"Failed to sign up with passkey.")}Y("/")}catch(a){p(n,w(F(a)))}}const ie=re(),[K,Pe]=ie;var P=Re(),J=y(P),M=h(y(J),2);Ae(M,{});var G=h(M,4);{var se=i=>{var a=Oe(),f=y(a);N(f),C(2),b(a),H("submit",a,ae),S(f,()=>u(s),g=>p(s,g)),j(i,a)};U(G,i=>{u(I)===null&&i(se)})}var L=h(G,2);{var oe=i=>{var a=Ue(),f=y(a);f.__click=V,b(a),j(i,a)};U(L,i=>{u(I)===!0&&i(oe)})}var D=h(L,2);{var le=i=>{var a=qe(),f=y(a);N(f);var g=h(f,2);N(g);var k=h(g,2);N(k);var E=h(k,2);N(E),C(2),b(a),H("submit",a,ne),S(f,()=>u(c),v=>p(c,v)),S(g,()=>u(m),v=>p(m,v)),S(k,()=>u(l),v=>p(l,v)),S(E,()=>u(s),v=>p(s,v)),j(i,a)};U(D,i=>{u(I)===!1&&i(le)})}var T=h(D,2),z=h(y(T));q(()=>$(z,"href",K("/terms",void 0)));var ue=h(z,2);q(()=>$(ue,"href",K("/privacy-policy",void 0))),C(),b(T);var ce=h(T,2);{var fe=i=>{var a=Ce(),f=y(a,!0);b(a),q(()=>ge(f,u(n))),j(i,a)};U(ce,i=>{u(n)&&i(fe)})}b(J),b(P),j(r,P),te(),o()}he(["click"]);export{Ge as component};
