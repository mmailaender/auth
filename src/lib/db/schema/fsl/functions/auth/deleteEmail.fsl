@role(server)
function deleteEmail(email: String): User {
    let user = User.firstWhere(.emails.includes(email))
    if(user != null) {
        if(user!.primaryEmail != email) {
            user!.update({
                emails: user!.emails!.filter(e => e != email)
            })
        } else {
            abort("Can't delete an email which is set as primaryEmail.")
        }
    } else {
        abort("No User found with the provided email")
    }
}