collection User {
    firstName: String
    lastName: String
    email: String
    image: String | Null
    accounts: Array<Ref<Account>>

    check isValidRegistration ((user) => {
      if (user.accounts!.any((account) => account!.provider == "Passkey")) {
          Registration.all().any((registration) => registration.email == user.email)
      } else {
          true
      }
    })

    unique [.email]
    unique [mva(.accounts)]

    migrations {
      drop .emailVerified
    }
}